---
post_id: 2239
title: 'WinFM &#8211; Mesure de la bande passante utilisÃ©e'
date: '2001-09-19T13:35:35+02:00'

author: 'RÃ©mi Peyronnet'
layout: post
guid: '/?p=2239'
slug: winfm
permalink: /2001/09/winfm/
URL_before_HTML_Import: 'http://www.lprp.fr/win/winfm/winfm.php3'
image: /files/2018/11/flow_meter_1541192490.jpg
categories:
    - Informatique
tags:
    - OldWeb
    - Software
lang: fr
---

**Attention**, ce programme est loin dâ€™Ãªtre fini, et les procÃ©dures dâ€™installation nâ€™ont pas pu Ãªtre testÃ©es sur tous les systÃ¨mes.

[Pourquoi ?](#pkoi)  
[Principe](#pr)  
[Installation](#in)  
[Guide](#guide)  
[Download](#dl) : [WinFM.zip](/files/old-web/win/winfm/winfm.zip)  
[Extensions](#ext)  
[ToDo](#todo)

<a name="pkoi"></a>

## Pouquoi ?

Il est souvent utile de connaÃ®tre la quantitÃ© de donnÃ©es qui a transitÃ© par le rÃ©seau. Divers outils existent dÃ©jÃ , mais ne sont pas pratique lorsquâ€™on est sur un rÃ©seau local, et quâ€™on ne dÃ©sire pas comptabiliser les Ã©changes effectuÃ©s sur le rÃ©seau local.

Des solutions existent sous linux, (voir [IPFM](http://robert.cheramy.net/ipfm/)), mais peu sous Windows. Un projet, [ethereal](http://www.ethereal.com) a rendu Ã§a possible aussi sans douleurs sous Windows.

Mais je nâ€™ai pas trouvÃ© que lâ€™utilisation Ã©tait pratique. Je voulais quelque chose qui puisse simplement afficher la quantitÃ© tÃ©lÃ©chargÃ©e depuis lâ€™extÃ©rieur.Jâ€™ai donc Ã©crit une petite application pour faciliter tout cela.

<a name="pr"></a>

## Principe

Le principe est trÃ¨s simple, et tirÃ© du monde Unix : il sâ€™agit dâ€™utiliser :

- **tethereal** : detecte les paquets rÃ©seau et les trie selon un filtre quâ€™on lui donne en paramÃ¨tre. Ce programme est en mode console, sa sortie est ensuite redirigÃ©e Ã  lâ€™aide dâ€™un tube pour la suite du script
- **un peu de grep/awk** qui a pour mission de rÃ©cuperer lâ€™information qui nous intÃ©resse, Ã  savoir la somme des paquets reÃ§us. La sortie de ce script est ensuite redirigÃ©e dans un tube nommÃ© .pipewinfm pour pouvoir Ãªtre lu dans lâ€™application windows.
- **lâ€™application Windows** lâ€™application Windows, qui a lancÃ© ces scripts, va rÃ©cupÃ©rer simplement les informations qui lâ€™intÃ©resse par lâ€™intermÃ©diaire du tube nommÃ©, et le prÃ©sentÃ© dans la TrayBar

Pour trier les paquets, ce qui mâ€™intÃ©resse essentiellement est la taille des paquets arrivant sur mon ordinateur (dst host xxx.xxx.xxx.xxx) depuis des ordinateurs non situÃ©s sur le rÃ©seau local (and not src host xxx.xxx, pour le cas dâ€™une classe B). Jâ€™utilise ensuite lâ€™option -V pour que tethereal dÃ©code les paquets pour moi et me donne la taille, qui est rÃ©cupÃ©rÃ©e ensuite avec un grep. Le awk ser a sommer tous les paquets.  
Les outils sed et awk sont ceux de lâ€™excellent port pour windows de lâ€™environnemen unix : cygwin.

<a name="in"></a>

## Installation

Lâ€™installation nâ€™est pour lâ€™instant pas des plus simples :

1. DÃ©compactez lâ€™archive
2. Installez le driver NDIS
3. Installez le Packet.dll correspondant Ã  votre systÃ¨me dâ€™exploitation
4. Copiez le rÃ©pertoire contenant les programmes la ou vous voulez

Pour les trois premiers points, vous pouvez vous rÃ©ferez Ã  la documentation dâ€™[ethereal](http://www.ethereal.com). Si vous arrivez Ã  faire fonctionner ethereal, vous nâ€™aurez aucune difficultÃ© Ã  faire fonctionner le programme.

Il reste maintenant une petite Ã©tape de configuration : vous devez mettre votre adresse IP *(winipcfg ou ipconfig pour le connaÃ®tre)* dans le fichier script.bat Ã  la place de src host xxx.xxx.xxx.xxx. Nâ€™oubliez pas non plus dâ€™adapter le rÃ©seau que vous voulez surveiller (not dst host xxx.xxx).

<a name="guide"></a>

## Guide

Lancez le fichier WinFM.exe. Vous devriez voir apparaÃ®tre dans la TrayBar (Ã  gauche de lâ€™heure) une petite icÃ´ne qui vous Ã©tait jusque lÃ  inconnue.

### Fonctionnement global

- ArrÃªtez vous quelques instants sur lâ€™icÃ´ne. Une bulle vous donnera la quantitÃ© consommÃ©e depuis le dÃ©marrage de lâ€™application. Attention les deux premiÃ¨res valeurs ne sont pas significatives (câ€™est Ã  dire, au moins deux paquets doivent avoir transitÃ© sur ce rÃ©seau).
- Dans le menu contextuel, Settings vous permet de paramÃ¨trer un peu lâ€™application. Vous pouvez definir deux niveaux dâ€™alertes. Le premier niveau (niveau Jaune) consiste juste Ã  afficher lâ€™icÃ´ne au fond jaune lorsque lâ€™on double clique sur lâ€™icÃ´ne. Le deuxiÃ¨me niveau (Rouge), change lâ€™icÃ´ne mÃªme si vous ne double cliquez pas. Vous pouvez demander aussi dâ€™additionner systÃ©matiquement (ou soustraire) une certaine valeur (pratique pour les reports de quantitÃ©s tÃ©lÃ©chargÃ©es dâ€™un reboot Ã  lâ€™autre)
- Check dans le menu, ou un double clic sur lâ€™icÃ´ne affiche pendant quelques instants le niveau dâ€™alerte, vert jaune ou rouge.

<a name="dl"></a>

## Download

Binaires : distribution complÃ¨te [WinFM.zip](/files/old-web/win/winfm/winfm.zip)  
Les sources ne sont pas encore disponible, car le code nâ€™est vraiment pas prÃ©sentable pour lâ€™instant.

<a name="ext"></a>

## Extensions

Si vous avez bien suivi, en fait lâ€™application nâ€™est en rien spÃ©cifique Ã  tethereal. Elle appelle uniquement le script.bat qui peut contenir tout Ã  fait autre chose, pourvu que le script ait comme sortie une suite de nombres Ã  afficher dans la TrayBar.

Lâ€™utilisation des tubes nommÃ©s (named pipes) est sans doute la faÃ§on la plus facile de rÃ©cuperer le rÃ©sultat dâ€™une commande DOS dans un programme Windows.  
Pour ce qui est de lâ€™Ã©criture : monprgmdos &gt; .pipenameofthepipe.  
Pour ce qui est de la lecture, lâ€™adaptation du programme dâ€™exemple de MSDN se fait sans douleurs.

<a name="todo"></a>

## To Do List

- Faire le mÃ©nage dans le code
- Bug : Pour lâ€™instant les programmes lancÃ©s ne se terminent pas, malgrÃ© quelques TerminateProcess.
- Bug : Information fausse tant que deux paquets ne sont pas arrivÃ©s.
- Liste des adresses DNS lors de la communication
- Support de deux canaux : upload/download (dÃ©jÃ  rÃ©alisable en lanÃ§ant deux instances du programme et en intervertissant src et dst dans script.bat)

Mais cela risque dâ€™attendre un peu, sinon un certain chef de projet dâ€™un certain projet [Câ€™Nedra](http://www.cnedra.org) va pas Ãªtre content ğŸ™‚