---
post_id: 2125
title: 'IP Flow Meter'
date: '2004-11-02T13:35:35+01:00'

author: 'R√©mi Peyronnet'
layout: post
guid: '/?p=2125'
slug: ipfm
permalink: /2004/11/ipfm/
URL_before_HTML_Import: 'http://www.lprp.fr/linux/ipfm.php3'
image: /files/2018/11/flow_meter_1541192253.jpg
categories:
    - Informatique
tags:
    - Linux
    - OldWeb
lang: fr
lang-ref: pll_5bdcbb3e08954
lang-translations:
    en: ipfm_en
    fr: ipfm
---

Vous trouverez sur cette page les instructions pour utiliser IPFM pour surveiller votre consommation sur un r√©seau global.

Voir aussi :

- [WinFM](/2001/09/winfm/) pour conna√Ætre sa consommation sous Windows
- Le [correctif](#corr)

La page principale de IPFM est <http://www.via.ecp.fr/~tibob/ipfm/>  
Licence : GPL  
Auteurs : [Robert CHERAMY &lt;tibob@via.ecp.fr&gt;](mailto:tibob@via.ecp.fr), [Andres KRAPF &lt;dae@via.ecp.fr&gt;](mailto:dae@via.ecp.fr)  
Home Page : <a>http://www.via.ecp.fr/~tibob/ipfm/</a>

J‚Äôutilise IPFM pour conna√Ætre exactement la quantit√© de donn√©es √©chang√©es avec un r√©seau ext√©rieur.

## Installation

Pour installer IPFM, vous devez avoir :

- **libpcap, libpcap-dev**
- **les sources d‚Äô[IPFM](http://www.via.ecp.fr/~tibob/ipfm/)**

Il vous suffit ensuite de

- Compiler : make
- Installer : make install
- Lancer IPFM : ipfm

## Version patch√©e

J‚Äôai patch√© l√©g√®rement le code pour adapter IPFM √† ce que je voulais faire.  
Voici les modifications apport√©es :

- la signification de la commande **NOT WITH** du fichier de configuration est modifi√©e : cela ne signifie plus A du r√©seau MaskA est en relation avec B du r√©seau MaskB, mais A appartient au r√©seau MaskA, mais non au r√©sau MaskB.  
    L‚Äôutilit√© est simple : d√©finir un MaskA comme √©tant un r√©seau global, et MaskB comme le r√©seau local. Ainsi, ne seront loggu√©es que les √©changes avec le r√©seau global.
- possibilit√© de g√©n√©rer le fichier plusieurs fois pour une m√™me p√©riode de log.  
    Cela est utile lorsque l‚Äôon veut surveiller sa consommation au fur et √† mesure, et non uniquement en fin de journ√©e.

**ATTENTION :** les fichiers d‚Äôaide n‚Äôont pas √©t√© modifi√©s en cons√©quence. Vous verrer apparaitre les modification clairement dans le code source, dans le fichier data.c et filter.c essentiellement.

Le code source est disponible [ici](/files/old-web/linux/ipfm_0.10.4.modif_.tar.gz).

## Script de visualisation

Ceci est un petit script pour avoir rapidement la quantit√© d‚Äôinformations re√ßues et envoy√©es. Pour l‚Äôutiliser, le rendre ex√©ctuable et simplement taper `./ipfm-status`. Pour ceci, ipfm doit √™tre lanc√© et avoir fait au moins une √©criture sur le disque. Vous serez peut √™tre amen√©s √† modifier le nom du fichier source.

[T√©l√©charger le script](/files/old-web/linux/ipfm-status)

## Configuration

Voici mon fichier de configuration. Pour plus d‚Äôinformation, consulter la page de manuel.

[Voir ipfm.conf](/files/old-web/linux/ipfm.conf)

<a name="corr"></a>

## Correctif

Comme on me l‚Äôa judicieusement fait remarquer, vous pouvez r√©aliser ces deux taches en utilisant normalement IPFM :

- Uniquement le r√©seau global : LOG BOTH 138.195.128.0/255.255.240.0 NOT WITH 138.195.0.0/255.255.0.0 Il faut mettre en relation votre machine (ici en 138.195.xxx.yyy) avec tous, sauf (NOT WITH) avec le reseau 138.195, et ceci dans les deux sens (BOTH, emettre ou recevoir)
- Pour l‚Äô√©criture, il suffit d‚Äô√©crire dans des fichiers diff√©rents et traiter ca avec un autre script. Mais vous perdez la facilit√© du tri‚Ä¶ Apr√®s c‚Äôest une affaire de go√ªt üôÇ

Comme quoi, de temps en temps, le code C est plus compr√©hensible que la man page :-).